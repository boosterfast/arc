---
source: arc-script-test/compile/src/insta.rs
expression: s
input_file: arc-script-test/compile/src/expect-mlir-fail-todo/task-with-funs.arc
---
use arc_script::arcorn;
use arcon::prelude::*;
pub struct HandlerTest<
    'i,
    'source,
    'timer,
    'channel,
    O: 'static + Operator,
    B: Backend,
    C: ComponentDefinition,
> {
    pub op: &'i mut O,
    pub ctx: &'i mut OperatorContext<'source, 'timer, 'channel, O, B, C>,
    pub timestamp: Option<u64>,
}
#[derive(ArconState)]
pub struct TaskTest {
    #[ephemeral]
    pub x_0: i32,
}
fn Test(x_0: i32) -> OperatorBuilder<TaskTest> {
    OperatorBuilder {
        constructor: Arc::new(move |b| TaskTest { x_0 }),
        conf: Default::default(),
    }
}
impl Operator for TaskTest {
    type IN = Struct5valuei32End;
    type OUT = Struct5valuei32End;
    type TimerState = ArconNever;
    type OperatorState = Self;
    fn handle_element(
        &mut self,
        elem: ArconElement<Self::IN>,
        ref mut ctx: OperatorContext<Self, impl Backend, impl ComponentDefinition>,
    ) -> OperatorResult<()> {
        let ArconElement { timestamp, data } = elem;
        let event = data.value;
        let mut handler = HandlerTest {
            op: self,
            ctx,
            timestamp,
        };
        handler.handle(event);
        Ok(())
    }
    arcon::ignore_timeout!();
    arcon::ignore_persist!();
}
impl<'i, 'source, 'timer, 'channel, B: Backend, C: ComponentDefinition>
    HandlerTest<'i, 'source, 'timer, 'channel, TaskTest, B, C>
{
    fn handle(&mut self, event_0: i32) -> OperatorResult<()> {
        let y_1_0 = self.Test_add(event_0);
        let y_1_1 = self.emit(y_1_0);
        y_1_1;
        Ok(())
    }
    fn emit(&mut self, event_0: i32) {
        let data = Struct5valuei32End { value: event_0 };
        let elem = ArconElement {
            data,
            timestamp: self.timestamp,
        };
        self.ctx.output(elem);
    }
    pub fn Test_add(&mut self, y_0: i32) -> i32 {
        let y_1_0 = (self.op.x_0);
        let y_1_1 = y_1_0 + y_0;
        y_1_1
    }
}
#[arcorn::rewrite]
#[derive(Copy)]
pub struct Struct5valuei32End {
    value: i32,
}


