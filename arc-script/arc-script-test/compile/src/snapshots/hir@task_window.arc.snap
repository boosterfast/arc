---
source: arc-script-test/compile/src/insta.rs
expression: s
input_file: arc-script-test/compile/src/tests/expect_mlir_fail_todo/task_window.arc

---
task TumblingWindowSum() ~{ val: i32, key: i32 } -> ~{ val: i32, key: i32 } {
    startup trigger { val: { val: unit, key: 0 }, dur: 60 }
    timer unit
    timeout {
        x_1: { val: unit, key: i32 } => {
            if x_1.val == unit {
                let key_1: i32 = x_1.key in
                emit { val: agg_0, key: key_1 };
                agg_0 = 0;
                trigger { val: { val: unit, key: key_1 }, dur: 60 }
            } else {
                ???
            }
        }
    }
    state agg_0: i32 = 0
    on {
        x_0: { key: i32, val: i32 } => {
            let event_0: i32 = x_0.val in
            let key_0: i32 = x_0.key in
            agg_0 = agg_0 + event_0
        }
    }
}

